version: '3.8'

services:
  # 1. Django Backend
  backend:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: teqwa_backend
    restart: unless-stopped
    env_file: .env
    expose:
      - "8000"
    networks:
      - teqwa_network
  # 2. React Frontend (Build Stage)
#  frontend:
  #  build:
   #   context: ../teqwa-frontend
    #  dockerfile: Dockerfile
    #container_name: teqwa_frontend
    # This container just builds the files, Nginx will serve them.
   # networks:
    #  - teqwa_network

  # 3. Nginx (The Entry Point)
  nginx:
    image: nginx:stable-alpine
    container_name: teqwa_nginx
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ../nginx/default.conf:/etc/nginx/conf.d/default.conf:ro
      - ../nginx/ssl:/etc/nginx/ssl:ro # SSL certificates
      # Frontend is deployed on Vercel, so no frontend build volume needed
      - static_volume:/app/static
      - media_volume:/app/media
    depends_on:
      - backend
    networks:
      - teqwa_network

networks:
  teqwa_network:
    driver: bridge

volumes:
  static_volume:
  media_volume:
